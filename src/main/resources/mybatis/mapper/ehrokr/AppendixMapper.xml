<?xml version = "1.0" encoding = "UTF-8"  ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.netease.okr.mapper.okr.AppendixMapper">


	<resultMap type="com.netease.okr.model.entity.Appendix" id="AppendixResultMap">
		<id column="id" property="id"/>
		<result column="week_report_id" property="weekReportId"/>
		<result column="nos_key" property="nosKey"/>
		<result column="name" property="name"/>
		<result column="url" property="url"/>
		<result column="modify_time" property="modifyTime"  />
		<result column="create_time" property="createTime"  />
	</resultMap>
	
	
	<resultMap type="com.netease.okr.model.entity.Appendix" id="AppendixRelResultMap">
		<id column="id" property="id"/>
		<result column="appendix_id" property="appendixId"/>
		<result column="rel_id" property="relId"/>
		<result column="type" property="type"/>
		<result column="modify_time" property="modifyTime"  />
		<result column="create_time" property="createTime"  />
	</resultMap>
	
	<sql id="selectedAppendixColumns">
		id,
		week_report_id,
		nos_key,
		name,
		url,
		modify_time,
		create_time
	</sql>
	
	
	<select id="getAppendixByWeekReportId" resultMap="AppendixResultMap">
		select
		<include refid="selectedAppendixColumns"></include>
		from tb_appendix
		where week_report_id=#{weekReportId}
	</select>
	
	
	<select id="getAppendix" resultMap="AppendixResultMap">
		select
		<include refid="selectedAppendixColumns"></include>
		from tb_appendix
		where id=#{id}
	</select>
	
	
	<insert id="addAppendix" parameterType="com.netease.okr.model.entity.Appendix" useGeneratedKeys="true" keyProperty="id">
		insert into tb_appendix(
			id,
			<if test="weekReportId!=null">week_report_id,</if>
			<if test="name!=null and name!=''">name,</if>
			<if test="nosKey!=null and nosKey!=''">nos_key,</if>
			<if test="url!=null and url!=''">url,</if>
			create_time,
			modify_time
		)
		values(
			#{id},
			<if test="weekReportId!=null">#{content},</if>
			<if test="name!=null and name!=''">#{name},</if>
			<if test="nosKey!=null and nosKey!=''">#{nosKey},</if>
			<if test="url!=null and url!=''">#{url},</if>
			now(),
			now()
		)
	</insert>
	
	<update id="updateAppendix" parameterType="java.util.List">
		<foreach collection="list" item="item" index="index" separator=";">
			update tb_appendix set week_report_id = #{item.weekReportId}  where id = #{item.id}
		</foreach>
		 
	</update>
	
	<delete id="deleteAppendixByWeekReportId">
		delete from tb_appendix where week_report_id=#{weekReportId}
	</delete>
	
	<delete id="deleteAppendix">
		delete from tb_appendix where id=#{id}
	</delete>
	
	
	
	<!-- ******************************AppendixRel************************************ -->
	<sql id="selectedAppendixRelColumns">
		id,
		appendix_id,
		rel_id,
		type,
		modify_time,
		create_time
	</sql>
	
	<select id="getAppendixRelList" resultMap="AppendixRelResultMap">
		select
		<include refid="selectedAppendixRelColumns"></include>
		from tb_appendix
		where rel_id=#{relId}
	</select>
	
	<insert id="addAppendixRel" parameterType="java.util.List">
		insert into tb_appendix_rel(appendix_id, rel_id,type, create_time, modify_time) values 
		<foreach collection="list" item="item" index="index" separator=",">
			 (
			 #{item.appendixId},
			 #{item.relId},
			 #{item.type},
			 now(),
			 now()
			 )
		</foreach>
	</insert>
	
	
	<delete id="deleteAppendixRel">
		delete from tb_appendix_rel where rel_id=#{relId} and type=#{type}
	</delete>
	
	<delete id="deleteAppendixRelById">
		delete from tb_appendix_rel where id=#{id}
	</delete>
	
	
	
	
</mapper>